{"version":3,"sources":["webpack:///./src/components/annonce/AnnonceInbox.vue?ab74","webpack:///src/components/annonce/AnnonceInbox.vue","webpack:///./src/components/annonce/AnnonceInbox.vue?3f5d","webpack:///./src/components/annonce/AnnonceInbox.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","webId","attrs","inboxAnnonceFolder","authorizations","_v","_s","messages","length","_l","m","key","url","created","creator","annonce","title","text","staticStyle","on","$event","reply","directives","name","rawName","modifiers","showDeleteConfirm","onDelete","staticClass","domProps","deleteMessage","staticRenderFns","components","data","methods","urlToDelete","watch","init","computed","$store","state","solid","component"],"mappings":"8GAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAAe,MAAbJ,EAAIM,MAAeF,EAAG,MAAM,CAACA,EAAG,WAAW,CAACG,MAAM,CAAC,KAAOP,EAAIQ,mBAAmB,eAAiBR,EAAIS,eAAe,MAAQT,EAAIM,SAASF,EAAG,eAAe,CAACJ,EAAIU,GAAG,YAAYV,EAAIW,GAAGX,EAAIY,SAASC,QAAQ,gBAAgBb,EAAIc,GAAId,EAAY,UAAE,SAASe,GAAG,OAAOX,EAAG,oBAAoB,CAACY,IAAID,EAAEE,KAAK,CAACjB,EAAIU,GAAG,IAAIV,EAAIW,GAAGI,EAAEG,SAAS,MAAMlB,EAAIW,GAAGI,EAAEI,SAAS,OAAOf,EAAG,IAAI,CAACJ,EAAIU,GAAGV,EAAIW,GAAGI,EAAEK,QAAQC,UAAUrB,EAAIU,GAAG,QAAQV,EAAIW,GAAGI,EAAEO,MAAM,KAAKlB,EAAG,WAAW,CAACmB,YAAY,CAAC,cAAc,QAAQhB,MAAM,CAAC,QAAU,SAASiB,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOzB,EAAI0B,MAAMX,MAAM,CAACX,EAAG,SAAS,CAACG,MAAM,CAAC,KAAO,UAAU,GAAGH,EAAG,WAAW,CAACuB,WAAW,CAAC,CAACC,KAAK,UAAUC,QAAQ,2BAA2BC,UAAU,CAAC,kBAAiB,KAAQP,YAAY,CAAC,cAAc,QAAQhB,MAAM,CAAC,QAAU,UAAUiB,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOzB,EAAI+B,kBAAkBhB,MAAM,CAACX,EAAG,SAAS,CAACG,MAAM,CAAC,KAAO,YAAY,IAAI,MAAKH,EAAG,UAAU,CAACG,MAAM,CAAC,GAAK,iBAAiB,SAAW,GAAG,MAAQ,UAAUiB,GAAG,CAAC,GAAKxB,EAAIgC,WAAW,CAAC5B,EAAG,MAAM,CAAC6B,YAAY,MAAMC,SAAS,CAAC,UAAYlC,EAAIW,GAAGX,EAAImC,qBAAqB,IAAI,GAAG/B,EAAG,MAAM,CAACJ,EAAIU,GAAG,wDACjrC0B,EAAkB,G,gGCwCtB,eACA,eAIA,GACER,KAAM,eACNS,WAAY,CACV,SAAY,WAAhB,yDAEEC,KALF,WAMI,MAAO,CACL1B,SAAU,GACVuB,cAAe,GACf3B,mBAAoB,GACpBC,eAAgB,KAIpB,QAdF,WAcA,wJACA,SADA,8CAGE8B,QAAS,CACP,KADJ,WACA,iKAEA,cAFA,iCAIA,gEAJA,cAIA,EAJA,0BAMA,GANA,0BAMA,qBANA,KAMA,YANA,UAUA,mCAVA,oDAWA,qCAXA,QAcA,cAdA,+CAiBI,UAlBJ,WAkBA,8KACA,wDADA,iCAEA,mCAFA,OAEA,EAFA,OAGA,eACA,oGAEA,cANA,YAQA,YARA,wBASA,YATA,KAUA,KAVA,UAUA,kBAVA,0CAUA,MAVA,wBAUA,EAVA,OAWA,YACA,mBAZA,8DA0BI,SA5CJ,WA4CA,+JACA,sBADA,SAEA,4BAFA,OAGA,cAHA,8CAMIR,kBAlDJ,SAkDA,GACM9B,KAAKkC,cAAX,yCACMlC,KAAKuC,YAAczB,EAAEE,MAGzBwB,MAAF,CACInC,MADJ,WAEML,KAAKyC,SAGTC,SAAF,CACIrC,MADJ,WAEM,OAAOL,KAAK2C,OAAOC,MAAMC,MAAMxC,SC7HgU,I,YCOjWyC,EAAY,eACd,EACAhD,EACAqC,GACA,EACA,KACA,KACA,MAIa,aAAAW,E","file":"js/inbox.d3c98123.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[(_vm.webId != null)?_c('div',[_c('AclCheck',{attrs:{\"path\":_vm.inboxAnnonceFolder,\"authorizations\":_vm.authorizations,\"webId\":_vm.webId}}),_c('b-list-group',[_vm._v(\" INBOX ( \"+_vm._s(_vm.messages.length)+\" messages ) \"),_vm._l((_vm.messages),function(m){return _c('b-list-group-item',{key:m.url},[_vm._v(\" \"+_vm._s(m.created)+\" / \"+_vm._s(m.creator)+\" : \"),_c('b',[_vm._v(_vm._s(m.annonce.title))]),_vm._v(\" ::: \"+_vm._s(m.text)+\" \"),_c('b-button',{staticStyle:{\"margin-left\":\"auto\"},attrs:{\"variant\":\"light\"},on:{\"click\":function($event){return _vm.reply(m)}}},[_c('b-icon',{attrs:{\"icon\":\"pen\"}})],1),_c('b-button',{directives:[{name:\"b-modal\",rawName:\"v-b-modal.message-delete\",modifiers:{\"message-delete\":true}}],staticStyle:{\"margin-left\":\"auto\"},attrs:{\"variant\":\"danger\"},on:{\"click\":function($event){return _vm.showDeleteConfirm(m)}}},[_c('b-icon',{attrs:{\"icon\":\"trash\"}})],1)],1)}),_c('b-modal',{attrs:{\"id\":\"message-delete\",\"centered\":\"\",\"title\":\"Delete\"},on:{\"ok\":_vm.onDelete}},[_c('div',{staticClass:\"p-3\",domProps:{\"innerHTML\":_vm._s(_vm.deleteMessage)}})])],2)],1):_c('div',[_vm._v(\" You must login to manage your annonces inbox. \")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n\r\n  <div>\r\n    <div v-if=\"webId != null\">\r\n\r\n      <AclCheck :path=\"inboxAnnonceFolder\" :authorizations=\"authorizations\" :webId=\"webId\" />\r\n\r\n\r\n      <b-list-group>\r\n        INBOX ( {{ messages.length}} messages )\r\n        <b-list-group-item v-for=\"m in messages\" :key=\"m.url\">\r\n          {{ m.created }} / {{ m.creator}} : <b>{{m.annonce.title}}</b> ::: {{ m.text }}\r\n\r\n\r\n          <b-button variant=\"light\" @click=\"reply(m)\" style=\"margin-left:auto;\">\r\n            <b-icon icon=\"pen\"></b-icon>\r\n          </b-button>\r\n          <b-button variant=\"danger\" @click=\"showDeleteConfirm(m)\" style=\"margin-left:auto;\" v-b-modal.message-delete>\r\n            <b-icon icon=\"trash\"></b-icon>\r\n          </b-button>\r\n        </b-list-group-item>\r\n\r\n        <b-modal id=\"message-delete\" centered title=\"Delete\" @ok=\"onDelete\">\r\n          <div class=\"p-3\" v-html=\"deleteMessage\"></div>\r\n        </b-modal>\r\n\r\n      </b-list-group>\r\n\r\n    </div>\r\n\r\n    <div v-else>\r\n      You must login to manage your annonces inbox.\r\n    </div>\r\n  </div>\r\n\r\n\r\n</template>\r\n\r\n<script>\r\nimport auth from 'solid-auth-client';\r\nimport FC from 'solid-file-client'\r\nconst fc = new FC( auth )\r\nlet ldflex = window.solid\r\n\r\n// import { v4 as uuidv4 } from 'uuid';\r\n\r\nexport default {\r\n  name: \"AnnonceInbox\",\r\n  components: {\r\n    'AclCheck': () => import('@/components/solid/AclCheck'),\r\n  },\r\n  data() {\r\n    return {\r\n      messages: [],\r\n      deleteMessage: \"\",\r\n      inboxAnnonceFolder: \"\",\r\n      authorizations: [],\r\n      //  acl: {status: \"checking\"}\r\n    }\r\n  },\r\n  async created(){\r\n    this.init()\r\n  },\r\n  methods: {\r\n    async init(){\r\n\r\n      if (this.webId != null){\r\n        //get inbox Folder\r\n        let inboxFolder = await ldflex.data.from(this.webId)[this.webId]['http://www.w3.org/ns/ldp#inbox']\r\n        // get aannonce inbox folder\r\n        this.inboxAnnonceFolder = await `${inboxFolder}`+\"annonces/\"\r\n        //  this.acl.status = \"imagining a annonce folder\"\r\n        //  console.log(this.webId, this.inboxAnnonceFolder)\r\n        // await this.checkAcl(\"first run\")\r\n        if( !(await fc.itemExists(this.inboxAnnonceFolder)) ) {\r\n          await fc.createFolder(this.inboxAnnonceFolder) // only create if it doesn't already exist\r\n        }\r\n      }\r\n      this.readInbox()\r\n    },\r\n\r\n    async readInbox() {\r\n      if (this.inboxAnnonceFolder != undefined && this.inboxAnnonceFolder.length > 0){\r\n        let folder = await fc.readFolder(this.inboxAnnonceFolder)\r\n        console.log(folder)\r\n        let files = folder.files.sort((a,b) => new Date(b.created).getTime() - new Date(a.created).getTime());\r\n        // console.log(files)\r\n        this.messages = []\r\n        //\r\n        while ( files.length > 0){\r\n          let f = files.shift()\r\n          let m = await JSON.parse(await fc.readFile(f.url))\r\n          m.url = f.url\r\n          this.messages.push(m)\r\n          //  console.log(this.messages)\r\n          //  console.log(f)\r\n          // let resource = f.url+\"#this\"\r\n          // for await (const annonce_url of ldflex.data[resource]['http://purl.org/dc/terms/hasPart']){\r\n          //   let idx = this.annonces.findIndex(x => x.url === `${annonce_url}`)\r\n          //   if (idx === -1) {\r\n          //     this.annonces.push({url: `${annonce_url}`})\r\n          //   }\r\n          // }\r\n        }\r\n      }\r\n      //}\r\n    },\r\n    async onDelete(){\r\n      console.log(\"delete\")\r\n      await fc.deleteFile(this.urlToDelete)\r\n      this.readInbox()\r\n      //this.$store.dispatch('annonce/delete', this.idToDelete)\r\n    },\r\n    showDeleteConfirm(m){\r\n      this.deleteMessage= \"Do you want to delete <b>\"+m.url+\"</b>\"\r\n      this.urlToDelete = m.url\r\n    },\r\n  },\r\n  watch:{\r\n    webId(){\r\n      this.init()\r\n    }\r\n  },\r\n  computed:{\r\n    webId() {\r\n      return this.$store.state.solid.webId\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AnnonceInbox.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AnnonceInbox.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./AnnonceInbox.vue?vue&type=template&id=145b7827&\"\nimport script from \"./AnnonceInbox.vue?vue&type=script&lang=js&\"\nexport * from \"./AnnonceInbox.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}