(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["inbox"],{e288:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",["OK"!=e.acl.status?n("div",[n("h5",[e._v("ACL / Authorization verification : ")]),n("p",[e._v(" To allow other Authenticated Users to send you inbox message, you have to set correct Authorizations for "),n("b-badge",{attrs:{variant:"warning"}},[e._v(e._s(e.inboxAnnonceFolder))]),e._v(" as i'm not sure the are good : "),n("ul",[n("li",[n("b-badge",{attrs:{variant:"warning"}},[e._v(e._s(e.webId))]),e._v(" with "),n("b-badge",{attrs:{variant:"warning"}},[e._v("CONTROL")])],1),n("li",[e._v(' AuthenticatedAgent as "Poster" for the folder & "Submitters" for it\'s content ')])]),n("br"),n("a",{attrs:{href:"https://github.com/jeff-zucker/solid-file-client/issues/189",target:"_blank"}},[e._v(" More info about why You must change authorization on this folder")])],1),e._v(" You can do it manually at "),n("a",{attrs:{href:e.inboxAnnonceFolder,target:"_blank"}},[e._v(e._s(e.inboxAnnonceFolder))]),e._v(" or use this button. "),n("br"),"KO"==e.acl.status?n("b-button",{on:{click:e.setAcl}},[e._v("Set Authorization")]):e._e()],1):e._e(),null!=e.webId?n("b-list-group",[e._v(" INBOX ( "+e._s(e.messages.length)+" messages ) "),e._l(e.messages,(function(t){return n("b-list-group-item",{key:t.url},[e._v(" "+e._s(t.created)+" / "+e._s(t.creator)+" : "),n("b",[e._v(e._s(t.annonce.title))]),e._v(" ::: "+e._s(t.text)+" "),n("b-button",{staticStyle:{"margin-left":"auto"},attrs:{variant:"light"},on:{click:function(n){return e.reply(t)}}},[n("b-icon",{attrs:{icon:"pen"}})],1),n("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.message-delete",modifiers:{"message-delete":!0}}],staticStyle:{"margin-left":"auto"},attrs:{variant:"danger"},on:{click:function(n){return e.showDeleteConfirm(t)}}},[n("b-icon",{attrs:{icon:"trash"}})],1)],1)})),n("b-modal",{attrs:{id:"message-delete",centered:"",title:"Delete"},on:{ok:e.onDelete}},[n("div",{staticClass:"p-3",domProps:{innerHTML:e._s(e.deleteMessage)}})])],2):n("div",[e._v(" You must login to manage your annonces inbox. ")])],1)},a=[],s=n("1da1"),o=(n("96cf"),n("00e8")),c=n.n(o),i=n("7fed"),l=n.n(i),u=new l.a(c.a),d=window.solid,b={name:"AnnonceInbox",data:function(){return{messages:[],deleteMessage:"",inboxAnnonceFolder:"",acl:{status:"checking"}}},created:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.init();case 1:case"end":return t.stop()}}),t)})))()},methods:{init:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null==e.webId){t.next=15;break}return e.acl.status="finding webId",t.next=4,d.data.from(e.webId)[e.webId]["http://www.w3.org/ns/ldp#inbox"];case 4:return n=t.sent,e.acl.status="finding inbox",t.next=8,"".concat(n);case 8:return t.t0=t.sent,e.inboxAnnonceFolder=t.t0+"annonces/",e.acl.status="imagining a annonce folder",console.log(e.webId,e.inboxAnnonceFolder),t.next=14,e.checkAcl();case 14:e.readInbox();case 15:case"end":return t.stop()}}),t)})))()},checkAcl:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.acl.status="checking if folder exist",t.next=3,u.itemExists(e.inboxAnnonceFolder);case 3:if(t.sent){t.next=7;break}return e.acl.status="creating folder",t.next=7,u.createFolder(e.inboxAnnonceFolder);case 7:return e.acl.status="cheching authorizations",t.next=10,u.aclUrlParser(e.inboxAnnonceFolder);case 10:return e.acl.aclObject=t.sent,console.log("aclObject",JSON.stringify(e.acl.aclObject,void 0,2)),t.next=14,u.acl.createContent(e.inboxAnnonceFolder,e.acl.aclObject);case 14:e.acl.aclContent=t.sent,console.log("aclcontent",e.acl.aclContent),console.log("acl",e.acl),e.acl.status="KO";case 18:case"end":return t.stop()}}),t)})))()},setAcl:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r,a,s,o,c,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.acl.status="setting authorizations",t.next=4,u.acl.addUserMode({},[{agent:e.webId}],["Read","Write","Control"],["accessTo","default"]);case 4:return n=t.sent,t.next=7,u.acl.addUserMode(n,[{agentClass:"AuthenticatedAgent"}],["Append"],["default"]);case 7:return n=t.sent,t.next=10,u.acl.addUserMode({},[{agentClass:"AuthenticatedAgent"}],["Append","Read"],["accessTo"]);case 10:return r=t.sent,a=[n,r],t.next=14,u.acl.createContent(e.inboxAnnonceFolder,a);case 14:return s=t.sent,console.log("build an aclContent "+s),t.next=18,u.getItemLinks(e.inboxAnnonceFolder,{links:"include_possible"});case 18:return o=t.sent,c=o.acl,t.next=22,u.putFile(c,s,"text/turtle");case 22:i=t.sent,console.log("result",i),e.acl.status="OK",t.next=31;break;case 27:t.prev=27,t.t0=t["catch"](0),e.acl.status="ERROR : "+t.t0,alert(t.t0);case 31:case"end":return t.stop()}}),t,null,[[0,27]])})))()},readInbox:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u.readFolder(e.inboxAnnonceFolder);case 2:n=t.sent,console.log(n),r=n.files.sort((function(e,t){return new Date(t.created).getTime()-new Date(e.created).getTime()})),e.messages=[];case 6:if(!(r.length>0)){t.next=19;break}return a=r.shift(),t.t0=JSON,t.next=11,u.readFile(a.url);case 11:return t.t1=t.sent,t.next=14,t.t0.parse.call(t.t0,t.t1);case 14:s=t.sent,s.url=a.url,e.messages.push(s),t.next=6;break;case 19:case"end":return t.stop()}}),t)})))()},onDelete:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("delete"),t.next=3,u.deleteFile(e.urlToDelete);case 3:e.readInbox();case 4:case"end":return t.stop()}}),t)})))()},showDeleteConfirm:function(e){this.deleteMessage="Do you want to delete <b>"+e.url+"</b>",this.urlToDelete=e.url}},watch:{webId:function(){this.init()}},computed:{webId:function(){return this.$store.state.solid.webId}}},g=b,h=n("2877"),f=Object(h["a"])(g,r,a,!1,null,null,null);t["default"]=f.exports}}]);
//# sourceMappingURL=inbox.4dab28ee.js.map