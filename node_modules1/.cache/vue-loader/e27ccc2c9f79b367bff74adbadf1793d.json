{"remainingRequest":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Smag\\Documents\\dev\\bon-prix\\src\\components\\annonce\\AnnonceInbox.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\src\\components\\annonce\\AnnonceInbox.vue","mtime":1616634341536},{"path":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgYXV0aCBmcm9tICdzb2xpZC1hdXRoLWNsaWVudCc7DQppbXBvcnQgRkMgZnJvbSAnc29saWQtZmlsZS1jbGllbnQnDQpjb25zdCBmYyA9IG5ldyBGQyggYXV0aCApDQpsZXQgbGRmbGV4ID0gd2luZG93LnNvbGlkDQovLyBpbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICd1dWlkJzsNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAiQW5ub25jZUluYm94IiwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgbWVzc2FnZXM6IFtdLA0KICAgICAgZGVsZXRlTWVzc2FnZTogIiINCiAgICB9DQogIH0sDQogIGFzeW5jIGNyZWF0ZWQoKXsNCiAgICAvLyAgdGhpcy53ZWJJZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnNvbGlkLndlYklkDQogICAgdGhpcy5yZWFkSW5ib3goKQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgYXN5bmMgcmVhZEluYm94KCkgew0KICAgICAgaWYgKHRoaXMud2ViSWQgIT0gbnVsbCl7DQogICAgICAgIGxldCBpbmJveEZvbGRlciA9IGF3YWl0IGxkZmxleC5kYXRhLmZyb20odGhpcy53ZWJJZClbdGhpcy53ZWJJZF1bJ2h0dHA6Ly93d3cudzMub3JnL25zL2xkcCNpbmJveCddDQogICAgICAgIGxldCBpbmJveEFubm9uY2UgPSBgJHtpbmJveEZvbGRlcn1gKyJhbm5vbmNlcy8iDQogICAgICAgIGxldCBmb2xkZXIgPSBhd2FpdCBmYy5yZWFkRm9sZGVyKGluYm94QW5ub25jZSkNCiAgICAgICAgY29uc29sZS5sb2coZm9sZGVyKQ0KICAgICAgICBsZXQgZmlsZXMgPSBmb2xkZXIuZmlsZXMuc29ydCgoYSxiKSA9PiBuZXcgRGF0ZShiLmNyZWF0ZWQpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGEuY3JlYXRlZCkuZ2V0VGltZSgpKTsNCiAgICAgICAgLy8gY29uc29sZS5sb2coZmlsZXMpDQogICAgICAgIHRoaXMubWVzc2FnZXMgPSBbXQ0KICAgICAgICAvLw0KICAgICAgICB3aGlsZSAoIGZpbGVzLmxlbmd0aCA+IDApew0KICAgICAgICAgIGxldCBmID0gZmlsZXMuc2hpZnQoKQ0KICAgICAgICAgIGxldCBtID0gYXdhaXQgSlNPTi5wYXJzZShhd2FpdCBmYy5yZWFkRmlsZShmLnVybCkpDQogICAgICAgICAgbS51cmwgPSBmLnVybA0KICAgICAgICAgIHRoaXMubWVzc2FnZXMucHVzaChtKQ0KICAgICAgICAgIC8vICBjb25zb2xlLmxvZyh0aGlzLm1lc3NhZ2VzKQ0KICAgICAgICAgIC8vICBjb25zb2xlLmxvZyhmKQ0KICAgICAgICAgIC8vIGxldCByZXNvdXJjZSA9IGYudXJsKyIjdGhpcyINCiAgICAgICAgICAvLyBmb3IgYXdhaXQgKGNvbnN0IGFubm9uY2VfdXJsIG9mIGxkZmxleC5kYXRhW3Jlc291cmNlXVsnaHR0cDovL3B1cmwub3JnL2RjL3Rlcm1zL2hhc1BhcnQnXSl7DQogICAgICAgICAgLy8gICBsZXQgaWR4ID0gdGhpcy5hbm5vbmNlcy5maW5kSW5kZXgoeCA9PiB4LnVybCA9PT0gYCR7YW5ub25jZV91cmx9YCkNCiAgICAgICAgICAvLyAgIGlmIChpZHggPT09IC0xKSB7DQogICAgICAgICAgLy8gICAgIHRoaXMuYW5ub25jZXMucHVzaCh7dXJsOiBgJHthbm5vbmNlX3VybH1gfSkNCiAgICAgICAgICAvLyAgIH0NCiAgICAgICAgICAvLyB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIGFzeW5jIG9uRGVsZXRlKCl7DQogICAgICBjb25zb2xlLmxvZygiZGVsZXRlIikNCiAgICAgIGF3YWl0IGZjLmRlbGV0ZUZpbGUodGhpcy51cmxUb0RlbGV0ZSkNCiAgICAgIHRoaXMucmVhZEluYm94KCkNCiAgICAgIC8vdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2Fubm9uY2UvZGVsZXRlJywgdGhpcy5pZFRvRGVsZXRlKQ0KICAgIH0sDQogICAgc2hvd0RlbGV0ZUNvbmZpcm0obSl7DQogICAgICB0aGlzLmRlbGV0ZU1lc3NhZ2U9ICJEbyB5b3Ugd2FudCB0byBkZWxldGUgPGI+IittLnVybCsiPC9iPiINCiAgICAgIHRoaXMudXJsVG9EZWxldGUgPSBtLnVybA0KICAgIH0sDQogIH0sDQogIHdhdGNoOnsNCiAgICB3ZWJJZCgpew0KICAgICAgdGhpcy5yZWFkSW5ib3goKQ0KICAgIH0NCiAgfSwNCiAgY29tcHV0ZWQ6ew0KICAgIHdlYklkKCkgew0KICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnNvbGlkLndlYklkDQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["AnnonceInbox.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAyBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AnnonceInbox.vue","sourceRoot":"src/components/annonce","sourcesContent":["<template>\r\n  <b-list-group>\r\n    INBOX ( {{ messages.length}} messages )\r\n    <b-list-group-item v-for=\"m in messages\" :key=\"m.url\">\r\n      {{ m.created }} / {{ m.creator}} : <b>{{m.annonce.title}}</b> ::: {{ m.text }}\r\n\r\n\r\n      <b-button variant=\"light\" @click=\"reply(m)\" style=\"margin-left:auto;\">\r\n        <b-icon icon=\"pen\"></b-icon>\r\n      </b-button>\r\n      <b-button variant=\"danger\" @click=\"showDeleteConfirm(m)\" style=\"margin-left:auto;\" v-b-modal.message-delete>\r\n        <b-icon icon=\"trash\"></b-icon>\r\n      </b-button>\r\n    </b-list-group-item>\r\n\r\n    <b-modal id=\"message-delete\" centered title=\"Delete\" @ok=\"onDelete\">\r\n      <div class=\"p-3\" v-html=\"deleteMessage\"></div>\r\n    </b-modal>\r\n\r\n  </b-list-group>\r\n\r\n\r\n</template>\r\n\r\n<script>\r\nimport auth from 'solid-auth-client';\r\nimport FC from 'solid-file-client'\r\nconst fc = new FC( auth )\r\nlet ldflex = window.solid\r\n// import { v4 as uuidv4 } from 'uuid';\r\n\r\nexport default {\r\n  name: \"AnnonceInbox\",\r\n  data() {\r\n    return {\r\n      messages: [],\r\n      deleteMessage: \"\"\r\n    }\r\n  },\r\n  async created(){\r\n    //  this.webId = this.$store.state.solid.webId\r\n    this.readInbox()\r\n  },\r\n  methods: {\r\n    async readInbox() {\r\n      if (this.webId != null){\r\n        let inboxFolder = await ldflex.data.from(this.webId)[this.webId]['http://www.w3.org/ns/ldp#inbox']\r\n        let inboxAnnonce = `${inboxFolder}`+\"annonces/\"\r\n        let folder = await fc.readFolder(inboxAnnonce)\r\n        console.log(folder)\r\n        let files = folder.files.sort((a,b) => new Date(b.created).getTime() - new Date(a.created).getTime());\r\n        // console.log(files)\r\n        this.messages = []\r\n        //\r\n        while ( files.length > 0){\r\n          let f = files.shift()\r\n          let m = await JSON.parse(await fc.readFile(f.url))\r\n          m.url = f.url\r\n          this.messages.push(m)\r\n          //  console.log(this.messages)\r\n          //  console.log(f)\r\n          // let resource = f.url+\"#this\"\r\n          // for await (const annonce_url of ldflex.data[resource]['http://purl.org/dc/terms/hasPart']){\r\n          //   let idx = this.annonces.findIndex(x => x.url === `${annonce_url}`)\r\n          //   if (idx === -1) {\r\n          //     this.annonces.push({url: `${annonce_url}`})\r\n          //   }\r\n          // }\r\n        }\r\n      }\r\n    },\r\n    async onDelete(){\r\n      console.log(\"delete\")\r\n      await fc.deleteFile(this.urlToDelete)\r\n      this.readInbox()\r\n      //this.$store.dispatch('annonce/delete', this.idToDelete)\r\n    },\r\n    showDeleteConfirm(m){\r\n      this.deleteMessage= \"Do you want to delete <b>\"+m.url+\"</b>\"\r\n      this.urlToDelete = m.url\r\n    },\r\n  },\r\n  watch:{\r\n    webId(){\r\n      this.readInbox()\r\n    }\r\n  },\r\n  computed:{\r\n    webId() {\r\n      return this.$store.state.solid.webId\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\r\n"]}]}