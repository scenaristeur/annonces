{"remainingRequest":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Smag\\Documents\\dev\\bon-prix\\src\\components\\portfolio\\Upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\src\\components\\portfolio\\Upload.vue","mtime":1616412818710},{"path":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Smag\\Documents\\dev\\bon-prix\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpsZXQgbGRmbGV4ID0gd2luZG93LnNvbGlkDQppbXBvcnQgRkMgZnJvbSAnc29saWQtZmlsZS1jbGllbnQnDQpjb25zdCBmYyA9IG5ldyBGQyggd2luZG93LnNvbGlkLmF1dGggKQ0KaW1wb3J0IHdhdGVybWFyayBmcm9tICd3YXRlcm1hcmtqcycNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAnVXBsb2FkJywNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgZmlsZXM6IG51bGwNCiAgICB9DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBhc3luYyBvbklucHV0KGZpbGVzKXsNCiAgICAgIGNvbnNvbGUubG9nKGZpbGVzKQ0KICAgICAgbGV0IHByZXZpZXcgPSB0aGlzLiRyZWZzLnByZXZpZXcNCiAgICAgIGxldCBzdG9yYWdlID0gYXdhaXQgbGRmbGV4LmRhdGEudXNlci5zdG9yYWdlDQogICAgICBsZXQgcGF0aCA9IGAke3N0b3JhZ2V9YCsncHVibGljL3BvcnRmb2xpby8nDQogICAgICBhd2FpdCBmaWxlcy5mb3JFYWNoKGFzeW5jIGZ1bmN0aW9uKGYpICB7DQogICAgICAgIGNvbnNvbGUubG9nKGYpDQogICAgICAgIHdhdGVybWFyayhbZl0pDQogICAgICAgIC5pbWFnZSh3YXRlcm1hcmsudGV4dC5jZW50ZXIocGF0aCwgJzMwcHggSm9zZWZpbiBTbGFiJywgJyNmZmYnLCAwLjgpKQ0KICAgICAgICAudGhlbihpbWcgPT4gew0KICAgICAgICAgIGltZy5uYW1lID0gZi5uYW1lDQogICAgICAgICAgaW1nLnR5cGUgPSBmLnR5cGUNCiAgICAgICAgICBwcmV2aWV3LmFwcGVuZENoaWxkKGltZyl9KTsNCiAgICAgICAgfSkNCiAgICAgIH0sDQogICAgICBhc3luYyBzZW5kKCl7DQogICAgICAgIGxldCBwcmV2aWV3ID0gdGhpcy4kcmVmcy5wcmV2aWV3DQogICAgICAgIGxldCBkYXRhVVJMdG9GaWxlID0gdGhpcy5kYXRhVVJMdG9GaWxlDQogICAgICAgIHZhciBpbWFnZXMgPSBbXS5zbGljZS5jYWxsKHByZXZpZXcuY2hpbGRyZW4pOw0KICAgICAgICBjb25zb2xlLmxvZyhpbWFnZXMpDQogICAgICAgIGxldCBzdG9yYWdlID0gYXdhaXQgbGRmbGV4LmRhdGEudXNlci5zdG9yYWdlDQogICAgICAgIGxldCBwYXRoID0gYCR7c3RvcmFnZX1gKydwdWJsaWMvcG9ydGZvbGlvLycNCiAgICAgICAgY29uc29sZS5sb2cocGF0aCkNCiAgICAgICAgdHJ5ew0KICAgICAgICAgIGF3YWl0IGltYWdlcy5mb3JFYWNoKGFzeW5jIGZ1bmN0aW9uKGkpICB7DQogICAgICAgICAgICBsZXQgdXJpID0gcGF0aCtpLm5hbWUNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVuY29kZVVSSSh1cmkpKQ0KICAgICAgICAgICAgdmFyIGZpbGUgPSBkYXRhVVJMdG9GaWxlKGkuc3JjLGkubmFtZSk7DQogICAgICAgICAgICBhd2FpdCBmYy5jcmVhdGVGaWxlKGVuY29kZVVSSSh1cmkpLCBmaWxlLCBpLnR5cGUpDQogICAgICAgICAgfSkNCiAgICAgICAgICBhbGVydChpbWFnZXMubGVuZ3RoKyIgZmljaGllcnMgc2F1dmVnYXJkw6lzIikNCiAgICAgICAgfWNhdGNoKGUpew0KICAgICAgICAgIGFsZXJ0KGUpDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICBkYXRhVVJMdG9GaWxlKGRhdGF1cmwsIGZpbGVuYW1lKSB7DQogICAgICAgIHZhciBhcnIgPSBkYXRhdXJsLnNwbGl0KCcsJyksDQogICAgICAgIG1pbWUgPSBhcnJbMF0ubWF0Y2goLzooLio/KTsvKVsxXSwNCiAgICAgICAgYnN0ciA9IGF0b2IoYXJyWzFdKSwNCiAgICAgICAgbiA9IGJzdHIubGVuZ3RoLA0KICAgICAgICB1OGFyciA9IG5ldyBVaW50OEFycmF5KG4pOw0KICAgICAgICB3aGlsZShuLS0pew0KICAgICAgICAgIHU4YXJyW25dID0gYnN0ci5jaGFyQ29kZUF0KG4pOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuZXcgRmlsZShbdThhcnJdLCBmaWxlbmFtZSwge3R5cGU6bWltZX0pOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICA="},{"version":3,"sources":["Upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAkBA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Upload.vue","sourceRoot":"src/components/portfolio","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <b-form-file multiple\r\n    accept=\"image/*\"\r\n    v-model=\"files\"\r\n    :state=\"Boolean(files)\"\r\n    placeholder=\"Choose a file or drop it here...\"\r\n    drop-placeholder=\"Drop file here...\"\r\n    @input=\"onInput\"\r\n    ></b-form-file>\r\n\r\n    <div ref=\"preview\"></div>\r\n    <b-button @click=\"send\">Envoyer</b-button>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nlet ldflex = window.solid\r\nimport FC from 'solid-file-client'\r\nconst fc = new FC( window.solid.auth )\r\nimport watermark from 'watermarkjs'\r\n\r\nexport default {\r\n  name: 'Upload',\r\n  data() {\r\n    return {\r\n      files: null\r\n    }\r\n  },\r\n  methods: {\r\n    async onInput(files){\r\n      console.log(files)\r\n      let preview = this.$refs.preview\r\n      let storage = await ldflex.data.user.storage\r\n      let path = `${storage}`+'public/portfolio/'\r\n      await files.forEach(async function(f)  {\r\n        console.log(f)\r\n        watermark([f])\r\n        .image(watermark.text.center(path, '30px Josefin Slab', '#fff', 0.8))\r\n        .then(img => {\r\n          img.name = f.name\r\n          img.type = f.type\r\n          preview.appendChild(img)});\r\n        })\r\n      },\r\n      async send(){\r\n        let preview = this.$refs.preview\r\n        let dataURLtoFile = this.dataURLtoFile\r\n        var images = [].slice.call(preview.children);\r\n        console.log(images)\r\n        let storage = await ldflex.data.user.storage\r\n        let path = `${storage}`+'public/portfolio/'\r\n        console.log(path)\r\n        try{\r\n          await images.forEach(async function(i)  {\r\n            let uri = path+i.name\r\n            console.log(encodeURI(uri))\r\n            var file = dataURLtoFile(i.src,i.name);\r\n            await fc.createFile(encodeURI(uri), file, i.type)\r\n          })\r\n          alert(images.length+\" fichiers sauvegard√©s\")\r\n        }catch(e){\r\n          alert(e)\r\n        }\r\n      },\r\n      dataURLtoFile(dataurl, filename) {\r\n        var arr = dataurl.split(','),\r\n        mime = arr[0].match(/:(.*?);/)[1],\r\n        bstr = atob(arr[1]),\r\n        n = bstr.length,\r\n        u8arr = new Uint8Array(n);\r\n        while(n--){\r\n          u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new File([u8arr], filename, {type:mime});\r\n      }\r\n    }\r\n  }\r\n  </script>\r\n"]}]}