{"version":3,"sources":["webpack:///./src/components/annonce/AnnonceInbox.vue?72c4","webpack:///src/components/annonce/AnnonceInbox.vue","webpack:///./src/components/annonce/AnnonceInbox.vue?3f5d","webpack:///./src/components/annonce/AnnonceInbox.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","_v","_s","messages","length","_l","m","key","url","created","creator","annonce","title","text","staticStyle","attrs","on","$event","reply","directives","name","rawName","modifiers","showDeleteConfirm","onDelete","staticClass","domProps","deleteMessage","staticRenderFns","data","methods","urlToDelete","watch","webId","readInbox","computed","$store","state","solid","component"],"mappings":"uHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,eAAe,CAACJ,EAAIM,GAAG,YAAYN,EAAIO,GAAGP,EAAIQ,SAASC,QAAQ,gBAAgBT,EAAIU,GAAIV,EAAY,UAAE,SAASW,GAAG,OAAOP,EAAG,oBAAoB,CAACQ,IAAID,EAAEE,KAAK,CAACb,EAAIM,GAAG,IAAIN,EAAIO,GAAGI,EAAEG,SAAS,MAAMd,EAAIO,GAAGI,EAAEI,SAAS,OAAOX,EAAG,IAAI,CAACJ,EAAIM,GAAGN,EAAIO,GAAGI,EAAEK,QAAQC,UAAUjB,EAAIM,GAAG,QAAQN,EAAIO,GAAGI,EAAEO,MAAM,KAAKd,EAAG,WAAW,CAACe,YAAY,CAAC,cAAc,QAAQC,MAAM,CAAC,QAAU,SAASC,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOtB,EAAIuB,MAAMZ,MAAM,CAACP,EAAG,SAAS,CAACgB,MAAM,CAAC,KAAO,UAAU,GAAGhB,EAAG,WAAW,CAACoB,WAAW,CAAC,CAACC,KAAK,UAAUC,QAAQ,2BAA2BC,UAAU,CAAC,kBAAiB,KAAQR,YAAY,CAAC,cAAc,QAAQC,MAAM,CAAC,QAAU,UAAUC,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOtB,EAAI4B,kBAAkBjB,MAAM,CAACP,EAAG,SAAS,CAACgB,MAAM,CAAC,KAAO,YAAY,IAAI,MAAKhB,EAAG,UAAU,CAACgB,MAAM,CAAC,GAAK,iBAAiB,SAAW,GAAG,MAAQ,UAAUC,GAAG,CAAC,GAAKrB,EAAI6B,WAAW,CAACzB,EAAG,MAAM,CAAC0B,YAAY,MAAMC,SAAS,CAAC,UAAY/B,EAAIO,GAAGP,EAAIgC,qBAAqB,IACpgCC,EAAkB,G,kEC0BtB,eACA,eAGA,GACER,KAAM,eACNS,KAFF,WAGI,MAAO,CACL1B,SAAU,GACVwB,cAAe,KAGnB,QARF,WAQA,wJAEA,cAFA,8CAIEG,QAAS,CACP,UADJ,WACA,yLAwCA,cAxCA,iCAyCA,gEAzCA,cAyCA,EAzCA,OA0CA,2BA1CA,SA2CA,gBA3CA,mDA4CA,kBA5CA,yBA+CA,kBA/CA,eA+CA,EA/CA,OAgDA,6BAhDA,UAiDA,yBAjDA,eAiDA,EAjDA,OAkDA,eAlDA,UAqDA,0FArDA,eAqDA,EArDA,iBAsDA,gFAtDA,eAsDA,EAtDA,iBAuDA,2EAvDA,eAuDA,EAvDA,iBA6DA,yBA7DA,eA6DA,EA7DA,OA8DA,sCA9DA,UAgEA,6CAhEA,wBAgEA,EAhEA,EAgEA,IAhEA,UAoEA,6BApEA,eAoEA,EApEA,OAqEA,wBArEA,UAwEA,gBAxEA,QAwEA,EAxEA,OAyEA,eACA,oGAEA,cA5EA,aA8EA,YA9EA,wBA+EA,YA/EA,KAgFA,KAhFA,UAgFA,kBAhFA,0CAgFA,MAhFA,wBAgFA,EAhFA,OAiFA,YACA,mBAlFA,+DA+FI,SAhGJ,WAgGA,+JACA,sBADA,SAEA,4BAFA,OAGA,cAHA,8CAMIP,kBAtGJ,SAsGA,GACM3B,KAAK+B,cAAX,yCACM/B,KAAKmC,YAAczB,EAAEE,MAGzBwB,MAAF,CACIC,MADJ,WAEMrC,KAAKsC,cAGTC,SAAF,CACIF,MADJ,WAEM,OAAOrC,KAAKwC,OAAOC,MAAMC,MAAML,SC7JgU,I,YCOjWM,EAAY,eACd,EACA7C,EACAkC,GACA,EACA,KACA,KACA,MAIa,aAAAW,E","file":"js/chunk-2d224d23.40d28401.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('b-list-group',[_vm._v(\" INBOX ( \"+_vm._s(_vm.messages.length)+\" messages ) \"),_vm._l((_vm.messages),function(m){return _c('b-list-group-item',{key:m.url},[_vm._v(\" \"+_vm._s(m.created)+\" / \"+_vm._s(m.creator)+\" : \"),_c('b',[_vm._v(_vm._s(m.annonce.title))]),_vm._v(\" ::: \"+_vm._s(m.text)+\" \"),_c('b-button',{staticStyle:{\"margin-left\":\"auto\"},attrs:{\"variant\":\"light\"},on:{\"click\":function($event){return _vm.reply(m)}}},[_c('b-icon',{attrs:{\"icon\":\"pen\"}})],1),_c('b-button',{directives:[{name:\"b-modal\",rawName:\"v-b-modal.message-delete\",modifiers:{\"message-delete\":true}}],staticStyle:{\"margin-left\":\"auto\"},attrs:{\"variant\":\"danger\"},on:{\"click\":function($event){return _vm.showDeleteConfirm(m)}}},[_c('b-icon',{attrs:{\"icon\":\"trash\"}})],1)],1)}),_c('b-modal',{attrs:{\"id\":\"message-delete\",\"centered\":\"\",\"title\":\"Delete\"},on:{\"ok\":_vm.onDelete}},[_c('div',{staticClass:\"p-3\",domProps:{\"innerHTML\":_vm._s(_vm.deleteMessage)}})])],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <b-list-group>\r\n    INBOX ( {{ messages.length}} messages )\r\n    <b-list-group-item v-for=\"m in messages\" :key=\"m.url\">\r\n      {{ m.created }} / {{ m.creator}} : <b>{{m.annonce.title}}</b> ::: {{ m.text }}\r\n\r\n\r\n      <b-button variant=\"light\" @click=\"reply(m)\" style=\"margin-left:auto;\">\r\n        <b-icon icon=\"pen\"></b-icon>\r\n      </b-button>\r\n      <b-button variant=\"danger\" @click=\"showDeleteConfirm(m)\" style=\"margin-left:auto;\" v-b-modal.message-delete>\r\n        <b-icon icon=\"trash\"></b-icon>\r\n      </b-button>\r\n    </b-list-group-item>\r\n\r\n    <b-modal id=\"message-delete\" centered title=\"Delete\" @ok=\"onDelete\">\r\n      <div class=\"p-3\" v-html=\"deleteMessage\"></div>\r\n    </b-modal>\r\n\r\n  </b-list-group>\r\n\r\n\r\n</template>\r\n\r\n<script>\r\nimport auth from 'solid-auth-client';\r\nimport FC from 'solid-file-client'\r\nconst fc = new FC( auth )\r\nlet ldflex = window.solid\r\n// import { v4 as uuidv4 } from 'uuid';\r\n\r\nexport default {\r\n  name: \"AnnonceInbox\",\r\n  data() {\r\n    return {\r\n      messages: [],\r\n      deleteMessage: \"\"\r\n    }\r\n  },\r\n  async created(){\r\n    //  this.webId = this.$store.state.solid.webId\r\n    this.readInbox()\r\n  },\r\n  methods: {\r\n    async readInbox() {\r\n\r\n\r\n      // @prefix : <#>.\r\n      // @prefix acl: <http://www.w3.org/ns/auth/acl#>.\r\n      // @prefix foaf: <http://xmlns.com/foaf/0.1/>.\r\n      // @prefix target: <./>.\r\n      //\r\n      // :ReadAppend\r\n      //     a acl:Authorization;\r\n      //     acl:accessTo target:;\r\n      //     acl:agentClass acl:AuthenticatedAgent;\r\n      //     acl:mode acl:Read, acl:Append.\r\n      //\r\n      // :ReadWriteControl\r\n      //     a acl:Authorization;\r\n      //     acl:accessTo target:;\r\n      //     acl:default target:;\r\n      //     acl:agent </profile/card#me>;\r\n      //     acl:agent <https://bourgeoa.solidcommunity.net/profile/card#me>;\r\n      //     acl:mode acl:Read, acl:Write, acl:Control.\r\n\r\n      //       @prefix : <#>.\r\n      // @prefix acl: <http://www.w3.org/ns/auth/acl#>.\r\n      // @prefix foaf: <http://xmlns.com/foaf/0.1/>.\r\n      // @prefix target: <./>.\r\n      //\r\n      // :ReadAppend\r\n      //     a acl:Authorization;\r\n      //     acl:accessTo target:;\r\n      //     acl:agentClass acl:AuthenticatedAgent;\r\n      //     acl:mode acl:Read, acl:Append.\r\n      //\r\n      // :ReadWriteControl\r\n      //     a acl:Authorization;\r\n      //     acl:accessTo target:;\r\n      //     acl:agent </profile/card#me>;\r\n      //     acl:mode acl:Read, acl:Write, acl:Control.\r\n\r\n\r\n      if (this.webId != null){\r\n        let inboxFolder = await ldflex.data.from(this.webId)[this.webId]['http://www.w3.org/ns/ldp#inbox']\r\n        let inboxAnnonce = `${inboxFolder}`+\"annonces/\"\r\n        if( !(await fc.itemExists(inboxAnnonce)) ) {\r\n          await fc.createFolder(inboxAnnonce) // only create if it doesn't already exist\r\n        }\r\n\r\n        let aclObject = await fc.aclUrlParser(inboxAnnonce)\r\n        console.log(\"inherit acl\",aclObject)\r\n        let aclContent = await fc.acl.createContent(inboxAnnonce, aclObject/*, options*/)\r\n        console.log(aclContent)\r\n\r\n        // add an other rule\r\n        let   aclUsers = await fc.acl.addUserMode({}, [{ agent: this.webId }], ['Read', 'Write', 'Control'], ['accessTo', 'default'])\r\n        aclUsers = await fc.acl.addUserMode(aclUsers, [{ agentClass: 'AuthenticatedAgent' }], ['Append'], ['default'])\r\n        aclUsers = await fc.acl.addUserMode(aclUsers, [{ agentClass: 'Agent' }], ['Append', 'Read'], ['accessTo'])\r\n\r\n        //      aclUsers = await fc.acl.addUserMode(aclUsers, [{ agent: 'https://bourgeoa.solidcommunity.net/profile/card#me' }], ['Read', 'Write', 'Control'], ['accessTo', 'default'])\r\n\r\n\r\n        //  let aclUsers = await fc.acl.addUserMode({}, [{ agentClass: 'AuthenticatedAgent'}], ['Read', 'Write'])\r\n        const aclContentNew = await fc.acl.createContent(inboxAnnonce, aclUsers)\r\n        console.log('build an aclContent ' + aclContentNew)\r\n\r\n        const { acl: aclUrl } = await fc.getItemLinks(inboxAnnonce, { links: 'include_possible'})\r\n        //    const links = await fc.getItemLinks(inboxAnnonce, { links: 'include_possible'})\r\n\r\n        //  console.log(links)\r\n        let result = await fc.putFile(aclUrl, aclContentNew, 'text/turtle')\r\n        console.log(\"result\",result)\r\n\r\n\r\n        let folder = await fc.readFolder(inboxAnnonce)\r\n        console.log(folder)\r\n        let files = folder.files.sort((a,b) => new Date(b.created).getTime() - new Date(a.created).getTime());\r\n        // console.log(files)\r\n        this.messages = []\r\n        //\r\n        while ( files.length > 0){\r\n          let f = files.shift()\r\n          let m = await JSON.parse(await fc.readFile(f.url))\r\n          m.url = f.url\r\n          this.messages.push(m)\r\n          //  console.log(this.messages)\r\n          //  console.log(f)\r\n          // let resource = f.url+\"#this\"\r\n          // for await (const annonce_url of ldflex.data[resource]['http://purl.org/dc/terms/hasPart']){\r\n          //   let idx = this.annonces.findIndex(x => x.url === `${annonce_url}`)\r\n          //   if (idx === -1) {\r\n          //     this.annonces.push({url: `${annonce_url}`})\r\n          //   }\r\n          // }\r\n        }\r\n      }\r\n    },\r\n    async onDelete(){\r\n      console.log(\"delete\")\r\n      await fc.deleteFile(this.urlToDelete)\r\n      this.readInbox()\r\n      //this.$store.dispatch('annonce/delete', this.idToDelete)\r\n    },\r\n    showDeleteConfirm(m){\r\n      this.deleteMessage= \"Do you want to delete <b>\"+m.url+\"</b>\"\r\n      this.urlToDelete = m.url\r\n    },\r\n  },\r\n  watch:{\r\n    webId(){\r\n      this.readInbox()\r\n    }\r\n  },\r\n  computed:{\r\n    webId() {\r\n      return this.$store.state.solid.webId\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AnnonceInbox.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AnnonceInbox.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./AnnonceInbox.vue?vue&type=template&id=68ad10e7&\"\nimport script from \"./AnnonceInbox.vue?vue&type=script&lang=js&\"\nexport * from \"./AnnonceInbox.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}